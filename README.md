# HengenPixelSimulator

数学ガールの秘密ノート ビットとバイナリー 第２章 に出てくる変幻ピクセルの実装です。

## ビルド方法

Stackでビルドする環境を作ります。
開発時は以下を参考にしました。
https://qiita.com/waddlaw/items/b83cd10311200095fe87  
https://qiita.com/waddlaw/items/49874f4cf9b680e4b015

開発時の環境

- Windows10
- Stack 2.1.1
- GHC 8.6.5

以下のコマンドを実行します。
```
stack build
```

## 動かし方

以下の構成でファイルを配置します。

```
.
│  HengenPixel.exe
│
└─data
    ├─filter
    │      some_filter.dat
    ├─graph
    │      some_graph.dat
    └─scanner
    　     some_scanner.dat
```

- scanner  
  変幻ピクセルの入力となるデータファイルを配置します。  
  サイズは16×16で、各ピクセルの情報を0/１で指定します。  
  **例)** F.dat
  ```
  0000000000000000
  0000000000000000
  0011111111111100
  0011111111111100
  0011111111111100
  0011100000000000
  0011100000000000
  0011111111100000
  0011111111100000
  0011111111100000
  0011100000000000
  0011100000000000
  0011100000000000
  0011100000000000
  0000000000000000
  0000000000000000
  ```

- filter  
  変幻ピクセルのフィルタとなるスクリプトファイルです。  
  基本的な記述は、オリジナルになるべく合わせていますが、完全に同じものではありません。  
  **例)** Left.dat
  ```
  program Left
    k <- 0
    while k < 16 do
      x <- RECEIVE[0]
      x <- x << 1
      SEND x
      k <- k + 1
    end-while
  end-program
  ```
  
- graph  
  スキャナ、フィルタ、プリンタのつながりを指定するファイルです。  
  **例)** borderF.dat

  ```
  s1 <- S F.dat
  f1 <- G border.dat
  p0 <- P

  s1 -> f1
  f1 -> p0
  ```

  **例)** border.dat
  ```
  f1             <- F Right.dat
  f2             <- F Left.dat
  f3             <- F Up.dat
  f4             <- F Down.dat
  f5, f6, f7, f9 <- F And.dat
  f8             <- F Complement.dat
  p0             <- P

  i0     -> f1, f2, f3, f4
  f1, f2 -> f5
  f3, f4 -> f6
  f5, f6 -> f7
  f7     -> f8
  i0, f8 -> f9
  f9     -> p0
  ```

## graphファイル
### 変数宣言

「<-」行でスキャナ、フィルタ、プリンタ、(入れ子の)グラフの宣言を行います。  
左辺は変数名で、右辺には要素の種類とパラメータを指定します。

右辺に指定できる要素は以下の4つです。

|要素の種類|パラメータ|説明
|:--:|:--:|:--|
|S|スキャナファイル名|スキャナ|
|F|フィルタファイル名|フィルタ|
|P|-|プリンタ<br>プリンタを受け取る変数にはp0のみ使用可能です。|
|G|グラフファイル名|グラフ|

### グラフ指定

「->」で各要素のつながりを表現します。※循環参照させると無限ループします。  

入れ子になったgraphファイルでは、入力された情報を使用できます。  
変数宣言は不要で、入力順にi0, i1, ・・・ の変数名が対応しています。

最終出力はプリンタ(変数名はp0のみ対応)としないと何も出力されないのでご注意ください。
